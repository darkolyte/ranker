<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        window.addEventListener('DOMContentLoaded', (e) => {
            let collection = document.getElementsByClassName("abc")

            const pairs = []

            for (i = 0; i < collection.length; i++) {
                for (j = i + 1; j < collection.length; j++) {
                    pairs.push([collection[i].id, collection[j].id])
                }
            }

            // maybe fetch these by id
            let left = document.getElementsByClassName("left")[0]
            let right = document.getElementsByClassName("right")[0]

            let scores = {}

            function processNextPair() {
                if (pairs.length === 0) {
                    // maybe fetch these by id
                    const form = document.getElementsByTagName("form")[0]
                    const input = document.getElementsByTagName("input")[0]
                    input.value = JSON.stringify(scores);
                    form.submit()
                    return;
                }
    
                const pair = pairs.shift();
    
                left.innerHTML = document.getElementById(pair[0]).innerHTML;
                left.setAttribute("data-id", pair[0])
                right.innerHTML = document.getElementById(pair[1]).innerHTML;
                right.setAttribute("data-id", pair[1])
    
                const handleClick = (event) => {
                    left.removeEventListener('click', handleClick);
                    right.removeEventListener('click', handleClick);

                    const leftId = left.getAttribute("data-id")
                    const rightId = right.getAttribute("data-id")

                    left.style.transition = "all 500ms linear"
                    right.style.transition = "all 500ms linear"
                    
                    let chosenId
                    

                    if (event.target === left) {
                        chosenId = pair[0]
                        left.style.backgroundColor = "green"
                       
                      
                    } else {
                        chosenId = pair[1]
                        right.style.backgroundColor = "green"               
                    }

                    scores[chosenId] = (scores[chosenId] || 0) + 1;
                    console.log("User chose:", chosenId, "Scores:", scores);            

                    setTimeout(() => {

                        
                        left.style.transition = "all 500ms cubic-bezier(.16,.8,.19,.98)"
                        right.style.transition = "all 500ms cubic-bezier(.16,.8,.19,.98)"

                        left.style.transform = "translateX(250%)"
                        right.style.transform = "translateX(250%)"

                        processNextPair();

                       setTimeout(() => {

                        left.style.transition = "none"
                        right.style.transition = "none"

                        left.style.backgroundColor = "white"
                        right.style.backgroundColor = "white"

                        left.style.transform = "translateX(-250%)"
                        right.style.transform = "translateX(-250%)"

                        setTimeout(() => {
                            left.style.transition = "all 500ms cubic-bezier(.48,.52,.24,.9)"
                            right.style.transition = "all 500ms cubic-bezier(.48,.52,.24,.9)"
                        
                            left.style.transform = "translateX(0%)"
                            right.style.transform = "translateX(0%)"

                        }, 100)
                   
                        }, 500);
                        
                    }, 500)
                    
                };
    
                left.addEventListener('click', handleClick);
                right.addEventListener('click', handleClick);
            }

            processNextPair();
        })
    </script>
    <style>
        .abc {
            display: none;
        }
        form {
            display: none;
        }

        .choice-holder {
            overflow: hidden;
        }

        .choice {
            flex: 1;
            padding: 100px;
            border: 1px solid black;
            border-radius: 8px;
            text-align: center;
        }

        .choice:first-child {
            border-right: 1px solid black;
        }

        .choice:hover {
            background: rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <h1>{{.Name}}</h1>
    {{range .Items}}
        <div class="abc" id="{{.ID}}">{{.Title}}</div>
    {{end}}

    <div class="choice-holder" style="display: flex; justify-content: space-around; gap: 8px;">
        <div class="choice left"></div>
        <div class="choice right"></div>
    </div>
    <form action="/collections/{{.ID}}/result"><input type="hidden" name="scores"></form>
</body>
</html>